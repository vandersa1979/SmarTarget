<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ALERTAS</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .sidebar { scrollbar-width: none; -ms-overflow-style: none; }
        .sidebar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="bg-slate-100">
    <div class="flex h-screen">
        <!-- Sidebar -->
        <aside class="w-64 bg-slate-800 text-white flex flex-col p-4 fixed h-full overflow-y-auto sidebar">
            <div class="text-center py-4 mb-5">
                <h1 class="text-2xl font-bold">SmarTarget</h1>
            </div>
            <nav class="flex-grow">
<a href="./home.html" class="flex items-center gap-3 px-4 py-2 rounded-lg hover:bg-slate-700"><span>🏠 Início</span></a>
<h2 class="text-xs font-semibold text-slate-400 uppercase mt-6 mb-2 px-4">Cadastros</h2>
<a href="./empresas.html" class="flex items-center gap-3 px-4 py-2 rounded-lg hover:bg-slate-700"><span>🏢 Empresas e Filiais</span></a>
<a href="./departamentos.html" class="flex items-center gap-3 px-4 py-2 rounded-lg hover:bg-slate-700"><span>📂 Áreas</span></a>
<a href="./equipes.html" class="flex items-center gap-3 px-4 py-2 rounded-lg hover:bg-slate-700"><span>👥 Equipes</span></a>
<a href="./cargos.html" class="flex items-center gap-3 px-4 py-2 rounded-lg hover:bg-slate-700"><span>💼 Cargos</span></a>
<a href="./usuarios.html" class="flex items-center gap-3 px-4 py-2 rounded-lg hover:bg-slate-700"><span>👤 Usuários</span></a>
<a href="./periodos.html" class="flex items-center gap-3 px-4 py-2 rounded-lg hover:bg-slate-700"><span>🗓️ Períodos de Avaliação</span></a>
<h2 class="text-xs font-semibold text-slate-400 uppercase mt-6 mb-2 px-4">Gestão de Metas</h2>
<a href="./okrs.html" class="flex items-center gap-3 px-4 py-2 rounded-lg hover:bg-slate-700"><span>🎯 OKRs</span></a>
<a href="./kpis.html" class="flex items-center gap-3 px-4 py-2 rounded-lg hover:bg-slate-700"><span>📊 KPIs</span></a>
<a href="./associacoes.html" class="flex items-center gap-3 px-4 py-2 rounded-lg hover:bg-slate-700"><span>🔗 Associações</span></a>
<a href="./vinculos.html" class="flex items-center gap-3 px-4 py-2 rounded-lg hover:bg-slate-700"><span>🔗 Vínculos OKR-KPI</span></a>
<h2 class="text-xs font-semibold text-slate-400 uppercase mt-6 mb-2 px-4">Estratégia</h2>
<a href="./okr-kpi-guia.html" class="flex items-center gap-3 px-4 py-2 rounded-lg hover:bg-slate-700"><span>📚 Guia OKR × KPI</span></a>
<a href="./canvas-swot.html" class="flex items-center gap-3 px-4 py-2 rounded-lg hover:bg-slate-700"><span>🧩 Canvas & SWOT</span></a>
<a href="./bsc.html" class="flex items-center gap-3 px-4 py-2 rounded-lg hover:bg-slate-700"><span>🧭 BSC</span></a>
<a href="./checkins.html" class="flex items-center gap-3 px-4 py-2 rounded-lg hover:bg-slate-700"><span>✅ Check-ins</span></a>
<a href="./acoes-corretivas.html" class="flex items-center gap-3 px-4 py-2 rounded-lg hover:bg-slate-700"><span>🛠️ Ações Corretivas</span></a>
<a href="./alertas.html" class="flex items-center gap-3 px-4 py-2 rounded-lg hover:bg-slate-700"><span>🔔 Alertas</span></a>
<a href="./relatorios.html" class="flex items-center gap-3 px-4 py-2 rounded-lg hover:bg-slate-700"><span>📑 Relatórios</span></a>
<h2 class="text-xs font-semibold text-slate-400 uppercase mt-6 mb-2 px-4">Análise</h2>
<a href="./mapa-estrategico.html" class="flex items-center gap-3 px-4 py-2 rounded-lg hover:bg-slate-700"><span>🗺️ Mapa Estratégico</span></a>
<a href="./dashboard.html" class="flex items-center gap-3 px-4 py-2 rounded-lg hover:bg-slate-700"><span>📈 Dashboard</span></a>
</nav>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 p-6">
<h1 class="text-2xl font-bold mb-4">Alertas</h1>
<div id="alerts" class="space-y-3"></div>
<script>
(function(){
  const alerts = [];
  const today = new Date().toISOString().slice(0,10);
  const kpis = JSON.parse(localStorage.getItem('kpis')||'[]');
  const okrs = JSON.parse(localStorage.getItem('okrs')||'[]');
  const acoes = JSON.parse(localStorage.getItem('acoesCorretivas')||'[]');
  const checkins = JSON.parse(localStorage.getItem('checkins')||'[]');

  // KPI abaixo da meta
  kpis.forEach(k=>{
    if ((k.valorAlvo||0)>0 && (k.valorRealizado||0) < (0.7*k.valorAlvo)) {
      alerts.push({tipo:'KPI', msg:`${k.nome}: abaixo de 70% da meta`});
    }
  });

  // Ações corretivas vencidas
  acoes.forEach(a=>{
    if (a.prazo && a.status!=='Concluída' && a.prazo < today) {
      alerts.push({tipo:'Ação', msg:`${a.titulo} vencida em ${a.prazo}`});
    }
  });

  // Check-in semanal (último check-in há > 7 dias)
  function daysBetween(d1, d2) { return Math.floor((new Date(d1)-new Date(d2))/(1000*60*60*24)); }
  const lastByItem = {};
  (checkins||[]).forEach(c=>{
    const k = c.tipo+':'+c.item;
    if (!lastByItem[k] || lastByItem[k] < c.data) lastByItem[k] = c.data;
  });
  Object.keys(lastByItem).forEach(k=>{
    if (daysBetween(today, lastByItem[k]) > 7) alerts.push({tipo:'Check-in', msg:`Sem check-in há mais de 7 dias — ${k}`});
  });

  const box = document.getElementById('alerts');
  if (alerts.length===0){
    box.innerHTML = '<div class="bg-green-50 border border-green-200 text-green-700 rounded-xl p-4">Nenhum alerta no momento.</div>';
  } else {
    box.innerHTML = alerts.map(a=>`<div class="bg-amber-50 border border-amber-200 text-amber-800 rounded-xl p-3">[${a.tipo}] ${a.msg}</div>`).join('');
  }
})();
</script>
</main>
    </div>
</body>
</html>
